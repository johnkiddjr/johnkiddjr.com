@model PortfolioPageViewModel
@inject MainSite.Services.IProjectService projectService

<div class="w3-row w3-center w3-padding">
    <div class="w3-col l1 m3 s1">&nbsp;</div>
    <div class="w3-col l10 m6 s10">
        <header class="w3-container w3-padding-32 w3-center w3-black">
            <h1 class="w3-jumbo">Portfolio</h1>
        </header>
        <div class="w3-row">
            <div class="w3-col l2 m3">
                <h2 class="w3-left-align vertical-center">Projects</h2>
            </div>
            <div class="w3-col l6 m2">&nbsp;</div>
            <div class="w3-col l2 m6 w3-container">
                <label for="ShowPlatform">Show Platform</label>
            </div>
            <div class="w3-col l2 m1">
                @{
                    var platforms = (await projectService.GetPlatforms()).OrderBy(x => x.PlatformName).Select(x => x.PlatformName).ToList();
                    platforms.Insert(0, "All");
                }
                @Html.DropDownList("ShowPlatform", new SelectList(platforms), new { title = "ShowPlatform", id = "showPlatform" })
            </div>
        </div>
        <div class="w3-row">
            @if(Model.ProjectData != null)
            {
                <div id="noneShown" style="display: none;">
                    <b>No projects match the selected filter.</b>
                </div>
                foreach(var project in Model.ProjectData.Projects)
                {
                    @if (project.Images != null && project.Images.Any())
                    {
                        var image = project.Images.First();

                        <div class="w3-col l6" data-platforms="@project.Platform">
                            <div class="w3-margin-right w3-margin-left w3-margin-bottom">
                                <a href="@Url.Action("ProjectLanding", new { slug = project.Slug })" style="text-decoration: none;">
                                    <div class="w3-card-4 w3-border">
                                        <div style="height: 200px;">
                                            <img class="w3-left w3-round w3-margin-right" style="height: auto; max-height: 100%; max-width: 45%" src="@(ContentHelper.GetUrlForResource(ContentType.images, image.ImageUrl))" alt="@image.AltText" />
                                            <h5>@project.Name</h5>
                                            <p>
                                                @project.ShortDescription
                                            </p>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="w3-col l6 m6" data-platforms="@project.Platform">
                            <a href="@Url.Action("ProjectLanding", new { slug = project.Slug })" style="text-decoration: none;">
                                <div class="w3-card-4 w3-border">
                                    <div style="height: 200px;">
                                        <h5>@project.Name</h5>
                                        <p>
                                            @project.ShortDescription
                                        </p>
                                    </div>
                                </div>
                            </a>
                        </div>
                    }
                }
            }
            else
            {
                <span>No projects to show</span>
            }
        </div>

        <div class="w3-left-align">
            @foreach (var group in Model.PortfolioData.LinkGroups)
            {
                <h2>@group.GroupName</h2>
                <div class="w3-row">
                    <div class="w3-col">
                        <ul>
                            @foreach (var link in group.Links)
                            {
                                <li class="text-start">
                                    <a href="@(link.Link)" target="_blank">@link.Text</a>
                                </li>
                            }
                        </ul>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        var showPlatformDropdown = document.getElementById("showPlatform");
        var projectDivs = document.querySelectorAll('[data-platforms]');
        var noneShownDiv = document.getElementById("noneShown");

        showPlatformDropdown.addEventListener("change", function () {
            var selectedPlatform = this.value;
            var projectsShown = 0;

            projectDivs.forEach(function (projectDiv) {
                var platforms = projectDiv.getAttribute("data-platforms").split(",");

                if (selectedPlatform === "All" || platforms.includes(selectedPlatform)) {
                    projectDiv.style.display = "block";
                    projectsShown++;
                }
                else {
                    projectDiv.style.display = "none";
                }
            });

            if (projectsShown === 0) {
                noneShownDiv.style.display = "block";
            }
            else {
                noneShownDiv.style.display = "none";
            }
        });
    });
</script>